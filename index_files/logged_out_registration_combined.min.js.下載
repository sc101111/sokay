(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function validateListener(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}}function Signal(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}Signal.prototype={VERSION:"1.0.0",memorize:false,_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){validateListener(listener,"add");return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){validateListener(listener,"addOnce");return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length,bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal;if(typeof define==="function"&&define.amd){define(function(){return signals})}else if(typeof module!=="undefined"&&module.exports){module.exports=signals}else{global["signals"]=signals}})(this);(function(window){"use strict";var XSRFProtector=new Class({token_input:null,initialize:function(token_value){var self=this;self.token_value=token_value;self.createElements()},createElements:function(){var self=this;self.post_forms=$$('form[method="post"]');self.unprotected_forms=self.post_forms.filter(self.filterProtectedForms);self.unprotected_forms.each(self.protectForm,self)},filterProtectedForms:function(form){if(form.get("data-xsrf-protection")){return false}form.set("data-xsrf-protection","enabled");return true},protectForm:function(form){var self=this;form.adopt(self.getTokenInput())},getTokenInput:function(){var self=this;if(self.token_input===null){self.token_input=new Element('input[name="token"][type="hidden"]');self.token_input.set("value",self.token_value)}return self.token_input.clone()},refresh:function(){var self=this;self.createElements()}});window.XSRFProtector=XSRFProtector})(window);(function(window){"use strict";var LoggedOutController=new Class({VIDEO_LOOP:{START_TIME:41,END_TIME:300},video_has_started:false,initialize:function(){var self=this;self.handleThingsThatShouldEventuallyBeHandledGlobally();self.createElements();self.attachEvents()},createElements:function(){var self=this;self.background_video=$$(".js-background_video")[0]},attachEvents:function(){var self=this,background_video=self.background_video;if(background_video){background_video.addEventListener("canplay",self.onVideoCanPlay.bind(self));background_video.addEventListener("timeupdate",self.onVideoTimeUpdate.bind(self));setTimeout(function(){self.startVideo()},1e3)}},handleThingsThatShouldEventuallyBeHandledGlobally:function(){var self=this;self.protectForms();self.createPlaceholderFallbacks();self.lightbox=new Lightbox("[data-lightbox]")},protectForms:function(){var self=this;self.xsrf_protector=new XSRFProtector(vimeo.xsrft)},createPlaceholderFallbacks:function(){var placeholder_elements;if("placeholder"in document.createElement("input")){return}placeholder_elements=$$("[placeholder]").each(function(input){new OverText(input,{textOverride:input.get("placeholder")})});return placeholder_elements},startVideo:function(){var self=this,background_video=self.background_video,VIDEO_LOOP=self.VIDEO_LOOP;if(!self.video_has_started){background_video.volume=0;background_video.currentTime=VIDEO_LOOP.START_TIME;self.video_has_started=true}background_video.play();background_video.removeClass.delay(500,background_video,"shy")},loopVideo:function(){var self=this,background_video=self.background_video,VIDEO_LOOP=self.VIDEO_LOOP;if(background_video.currentTime>=VIDEO_LOOP.END_TIME){background_video.currentTime=VIDEO_LOOP.START_TIME}},refreshFormView:function(form){var inputs=form.getElements("input"),visible_inputs=inputs.filter(function(input){return input.get("type").toLowerCase()!=="hidden"}),empty_inputs=visible_inputs.filter(function(input){return input.get("value").trim()===""}),next_active_input=empty_inputs.length?empty_inputs[0]:visible_inputs[0];next_active_input.focus();if(window.OverText){OverText.update()}},onVideoCanPlay:function(){var self=this;self.startVideo()},onVideoTimeUpdate:function(){var self=this;self.loopVideo()}});window.addEvent("domready",function(){window.LoggedOutController=new LoggedOutController})})(window);(function(document){var isIE=function(){var rv=-1,ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/");if(msie>0){rv=parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10)}else if(trident>0){var rv_num=ua.indexOf("rv:");rv=parseInt(ua.substring(rv_num+3,ua.indexOf(".",rv_num)),10)}return rv>-1}(),FormManager=function(form){var self=this,initial_focus=form.querySelector(".iris_form_text--alert");self.form=form;self.is_login_form=self.form.classList.contains("js-login_form");self.is_join_form=self.form.classList.contains("js-join_form");self.is_join_or_login_page=window.location.pathname.indexOf("/log_in")===0||window.location.pathname.indexOf("/join")===0;self.is_review_page=window.location.pathname.indexOf("/review/")!==-1;self.is_upload_page=window.location.pathname==="/upload";self.inputs=self.form.getElementsByTagName("input");self.submit_button=self.form.querySelector("[type=submit]");self.submit_reset_text=self.submit_button.getAttribute("value");self.submit_text=self.submit_button.getAttribute("data-submit-text");self.password_field=self.form.querySelector('input[name="password"]');self.email_field=self.form.querySelector('input[name="email"]');self.has_been_submitted=false;self.has_errors=false;self.invalid_fields=[];self.empty_fields=[];self.validation_advice=self.form.querySelector(".iris_notification");self._attachEvents();self.xhr=new XMLHttpRequest;if(!isIE&&(self.is_login_form||self.is_join_form)){if(initial_focus){initial_focus.focus()}else if(self.validation_advice.innerHTML===""){self.email_field.focus()}else{for(var j=0;j<self.inputs.length;j++){if(self.inputs[j].getAttribute("type")!=="hidden"){self.inputs[j].focus();break}}}}},registration_holder=null,registration_forms,forms=[],join_title=Copy.dict.join_modal_title,login_title=Copy.dict.login_modal_title,is_join_modal=false,was_join_modal=false,registration_modal=document.getElementById("lightbox_contentregistration_modal"),modal_header=null,flip_box_cards=[],toggle=function(event){var join_email=flip_box_cards[1].querySelector('input[name="email"]'),login_email=flip_box_cards[0].querySelector('input[name="email"]');if(!event.target.classList.contains("js-toggle")){return}if(event){event.preventDefault()}for(var j=0;j<flip_box_cards.length;j++){if(flip_box_cards[j].classList.contains("js-toggles")){flip_box_cards[j].classList.toggle("front");flip_box_cards[j].classList.toggle("back");if(j===0&&!login_email.value&&join_email.value){login_email.value=join_email.value}if(j===1&&login_email.value&&!join_email.value){join_email.value=login_email.value}}}modal_header.textContent=is_join_modal?login_title:join_title;is_join_modal=!is_join_modal;registration_modal.querySelector(".legal_copy").classList.toggle("l-hide")},_cookie=function(name,value,ttl,path,domain,secure){var future_date;if(arguments.length>1){if(ttl){future_date=new Date;future_date.setDate(future_date.getDate()+ttl)}document.cookie=name+"="+encodeURIComponent(value)+(future_date?"; expires="+future_date.toGMTString():"")+(path?"; path="+path:"")+(domain?"; domain="+domain:"")+(secure?"; secure":"");return true}return decodeURIComponent((("; "+document.cookie).split("; "+name+"=")[1]||"").split(";")[0])};FormManager.prototype._attachEvents=function(){var self=this;self.form.addEventListener("submit",self._onFormSubmit.bind(self));self.form.addEventListener("reset",self._onFormReset.bind(self));for(var j=0;j<self.inputs.length;j++){if(self.inputs[j].getAttribute("type")!=="submit"){self.inputs[j].addEventListener("input",self._onFieldInput.bind(self))}}};FormManager.prototype._onFieldInput=function(event){var self=this,field=event.target,invalid_index=self.invalid_fields.indexOf(field),empty_index=self.empty_fields.indexOf(field);if(!self.has_been_submitted){return}if(field.validity.valid){field.classList.remove("iris_form_text--alert");if(invalid_index!==-1){self.invalid_fields.splice(invalid_index,1)}if(empty_index!==-1){self.empty_fields.splice(empty_index,1)}if(self.invalid_fields.length===0&&self.empty_fields.length===0){self.submit_button.removeAttribute("disabled");self.validation_advice.classList.add("l-hide");self.validation_advice.innerHTML=""}return}field.classList.add("iris_form_text--alert");if(invalid_index===-1){self.invalid_fields.push(field)}self.validation_advice.innerHTML=field.getAttribute("title");self.validation_advice.classList.remove("l-hide")};FormManager.prototype._onFormReset=function(event){var self=this;self._resetForm();self.has_errors=false;self.has_been_submitted=false;self.invalid_fields=[];self.empty_fields=[];if(self.validation_advice){self.validation_advice.classList.add("l-hide")}for(var j=0;j<self.inputs.length;j++){self.inputs[j].classList.remove("iris_form_text--alert")}};FormManager.prototype._checkForErrors=function(){var self=this;for(var j=0;j<self.inputs.length;j++){var input=self.inputs[j],input_validity=input.validity;input.classList.remove("iris_form_text--alert");if(input_validity.valid){continue}if(input_validity.valueMissing){self.empty_fields.push(input);continue}self.invalid_fields.push(input)}if(self.invalid_fields.length>0){self.empty_fields=[]}};FormManager.prototype._onFormSubmit=function(event){var self=this;self.has_been_submitted=true;if(self.invalid_fields.length>0||self.empty_fields.length>0){event.preventDefault();return}self.submit_button.classList.add("is--loading");self.submit_button.setAttribute("disabled",true);self.submit_button.setAttribute("value",self.submit_text);self.submit_button.setAttribute("data-reset-text",self.submit_reset_text);self._checkForErrors();if(self.invalid_fields.length===0&&self.empty_fields.length===0){self._handleValidForm(event);return}event.preventDefault();self._resetForm();self._handleInvalidForm()};FormManager.prototype._handleInvalidForm=function(){var self=this,copy="";self.submit_button.setAttribute("disabled",true);if(self.invalid_fields.length>0){self.invalid_fields[0].focus()}else if(self.empty_fields.length>0){self.empty_fields[0].focus()}self.validation_advice.classList.remove("l-hide");if(self.invalid_fields.length===0){copy=self.is_join_form?Copy.dict.name_email_and_password:Copy.dict.email_and_password;console.log(copy);self.validation_advice.innerHTML=copy;for(var j=0;j<self.empty_fields.length;j++){self.empty_fields[j].classList.add("iris_form_text--alert")}return}self.validation_advice.innerHTML=self.invalid_fields[0].getAttribute("title")};FormManager.prototype._handleValidForm=function(event){var self=this;self.submit_button.classList.add("is--loading");self.submit_button.setAttribute("disabled",true);for(var i=0;i<self.inputs.length;i++){self.inputs[i].setAttribute("readonly",true)}if(!self.is_join_or_login_page&&(self.is_login_form||self.is_join_form)){event.preventDefault();self._sendForm()}if(self.validation_advice){self.validation_advice.classList.add("l-hide")}};FormManager.prototype._sendForm=function(){var self=this,time=false;self.xhr.open("POST",self.form.getAttribute("action"));self.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");self.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");self.xhr.onload=function(e){var errors,path=window.location.pathname,last_page=_cookie("last_page"),clip_id=path.split("/").pop(),player;if(this.status===200){if(self.is_join_form&&self.is_upload_page){window.location.reload();return}if(window.location.pathname.indexOf("/log_in")!==-1){path=last_page?last_page:"/";window.location=path}else if(self.is_join_form&&!self.is_review_page){if(path.indexOf("/join")===-1){_cookie("last_page",path)}path="/sign_up";window.location=path}else if(typeof PlayerManager!=="undefined"&&document.getElementById("clip")){player=PlayerManager.getPlayer(document.getElementById("clip"));if(player){time=Math.floor(player.currentTime)}if(time&&path.indexOf("#")===-1){path+="#at="+time;window.location=path;window.location.reload();return}}else if(typeof PlayerManager!=="undefined"&&document.getElementById("clip_"+clip_id)){player=PlayerManager.getPlayer(document.getElementById("clip_"+clip_id));if(player){time=Math.floor(player.currentTime)}if(time&&path.indexOf("#")===-1){path+="#at="+time;window.location=path;window.location.reload()}}vimeo.Modal.returnData=JSON.parse(this.responseText);vimeo.Modal.destroy();return}self._resetForm();self.has_errors=false;self.has_been_submitted=false;errors=JSON.parse(this.responseText);if(self.is_login_form&&(!errors||errors.length===0)){self.validation_advice.innerHTML=Copy.dict.email_password_mismatch;self.validation_advice.classList.remove("l-hide");self.password_field.focus();return}for(var key in errors){if(errors.hasOwnProperty(key)){self.validation_advice.innerHTML=errors[key];self.validation_advice.classList.remove("l-hide");var error_input=self.form.querySelector("input[name="+key+"]");if(error_input){error_input.classList.add("iris_form_text--alert");error_input.focus()}return}}};var formdata="";for(var j=0;j<self.inputs.length;j++){formdata+=self.inputs[j].getAttribute("name")+"="+encodeURIComponent(self.inputs[j].value)+"&"}self.xhr.send(formdata)};FormManager.prototype._resetForm=function(){var self=this;for(var j=0;j<self.inputs.length;j++){self.inputs[j].removeAttribute("readonly")}self.submit_button.classList.remove("btn_gray");self.submit_button.removeAttribute("disabled");self.submit_button.setAttribute("value",self.submit_reset_text);self.submit_button.setAttribute("data-submit-text",self.submit_text);self.submit_button.classList.remove("is--loading")};if(typeof document.createElement("input").checkValidity!=="function"){return}registration_holder=document.getElementById("registration_forms");if(!registration_holder){return}registration_forms=registration_holder.querySelectorAll("form");registration_modal=document.querySelector(".iris_modal-wrapper");if(registration_modal){modal_header=registration_modal.querySelector(".iris_modal-header span");if(window._gtm){window._gtm.push({event:"pageview",page_path:registration_holder.getAttribute("data-init-form")==="join"?"/join_modal":"/log_in_modal"})}}for(var j=0;j<registration_forms.length;j++){forms.push(new FormManager(registration_forms[j]))}if(window.location.pathname==="/upload"||window.location.pathname.indexOf("/review/")!==-1){flip_box_cards=registration_holder.querySelectorAll(".flip_box_card");is_join_modal=modal_header.textContent===join_title;was_join_modal=is_join_modal;registration_holder.addEventListener("click",toggle);registration_forms[0].addEventListener("reset",function(event){if(was_join_modal!==is_join_modal){toggle()}})}})(document);